angular.module("starter.controllers",[]).controller("HomeCtrl",function(e,t,o,a,s,n){e.$on("userInfo",function(o,a){t.jf=e.userInfo.jf});t.show=function(){t.imgUrl=a.imgUrl;var e={method:"zj_banner"};var o=a.zjPost(e);o.then(function(e){t.banners=e.value;t.myActiveSlide=1},function(e){console.log(e)})};t.show();t.doRefresh=function(){if(e.userInfo){t.jf=e.userInfo.jf}else{t.jf=0}var o={method:"zj_class_prodcut",attach:"1"};var s=a.zjPost(o);s.then(function(e){t.products=e.value},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.$on("$ionicView.beforeEnter",function(){t.doRefresh()})}).controller("loginpageMyCtrl",function(e,t,o,a,s,n){t.user={type:"1",pro:"210000",service:"1",username:"",pass:"",imgCode:""};t.getCodeImg=function(){var e=(new Date).getTime();var o=a.ajaxUrlfile+"captcha.php?"+e;t.codeImg=o};t.getCodeImg();var r={method:"getGameServiceNew"};var l=a.zjGet(r);l.then(function(e){t.gameService=e.value;t.gameServiceType=e.type;t.pros=e.pro;var a=localStorage.getItem("userInfo");a=JSON.parse(a);if(o.username&&o.sid){t.user.username=o.username;if(e.idValue[o.sid]){t.user.type=e.idValue[o.sid].type;t.user.pro=e.idValue[o.sid].province;t.user.service=o.sid}}else if(a){if(a.status){t.user.type=a.type;t.user.pro=a.province;t.user.service=a.service;t.user.username=a.gameId}}t.usernamePlaceholders=[,"游戏ID","代理商账号"]},function(e){console.log(e)});t.checkErrorTimes=function(e){var o={method:"getErrorTimes",username:e.username};var s=a.zjGet(o);s.then(function(e){t.errorTimes=e.loginErrorTimes},function(e){console.log(e)})};t.checkErrorTimes(t.user);t.logWarm=null;t.pushNotification={checked:true};t.isShow=true;t.changeShow=function(e){if(e){t.isShow=false}else{t.isShow=true}};t.LoginNow=function(e){var o=a.fLogin(e.username,e.pass,e.service,t.pushNotification.checked);var n=a.zjPost(o,"postlogin.php");n.then(function(o){t.checkErrorTimes(e);if(o.status){if(a.setUsername(o)){}}else{t.getCodeImg();t.user.imgCode="";t.logWarm=o.smg;s(function(){t.logWarm=""},3e3)}},function(e){console.log("链接失败")})};t.check=function(e){var o=true;if(t.errorTimes>=3){o=false;var s={method:"getCodeImg"};var n=a.zjGet(s);n.then(function(o){var a=o.authnum_session;if(a!=e.imgCode){alert("验证码错误～")}else{t.LoginNow(e)}},function(e){console.log(e)})}else{t.LoginNow(e)}}}).controller("userindexMyCtrl",function(e,t,o){e.$on("userInfo",function(o,a){t.jf=e.userInfo.jf});t.doRefresh=function(){if(e.userInfo){t.jf=e.userInfo.jf}else{t.jf=0}var a={method:"userinfo"};var s=o.zjPost(a);s.then(function(e){t.userInfo=e.value},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh();t.unbinkwx=function(){if(confirm("确定要退出积分商城吗？")){o.fLogOut()}}}).controller("couponCodeMyCtrl",function(e,t,o,a,s){t.cid=a.cid;t.imgUrl=o.ajaxUrlfile;t.doRefresh=function(){var e={method:"couponCode",attach:t.cid};var a=o.zjPost(e);a.then(function(e){t.status=e.status;if(e.status){t.c=e.value}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh()}).controller("activityMyCtrl",function(e,t,o,a,s){t.doRefresh=function(){var e={method:"getactivity"};var a=o.zjPost(e);a.then(function(e){t.imgUrl=o.imgUrl;t.status=e.status;if(e.status){t.banners=e.value}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh()}).controller("activityIndianalistMyCtrl",function(e,t,o,a){t.page=0;t.domore=false;t.list=[];t.loadeData=function(){var e={method:"activityIndianalist",page:t.page};var a=o.zjPost(e);a.then(function(e){t.imgUrl=o.imgUrl;t.status=e.status;if(e.status){t.banner=e.banner;for(v in e.value){t.list.push(e.value[v])}}else{t.domore=true}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.loadMore=function(){t.page++;t.loadeData()};t.doRefresh=function(){t.domore=false;t.page=0;t.list=[];t.loadeData()};t.doRefresh()}).controller("activityIndianaContentMyCtrl",function(e,t,o,a,s,n){t.username=e.username;t.buy={num:0};t.showpay=true;t.togglepayButton=function(){t.showpay=!t.showpay};t.count=function(e,o){var e=e.num;var a=t.indiana.number_limit-t.indiana.number_now;if(e<=0&&o<0){t.buy.num=0;return false}if(e>=a&&o>0){t.buy.num=a;return false}t.buy.num+=o};t.pay=function(n){var r=e.username;var l={cid:s.cid,num:n.num};var i=n.num*t.indiana.price;var c={method:"payIndiana",value:l};var u=o.zjPost(c);u.then(function(o){if(o.status){e.userInfo.jf=o.jf;e.$broadcast("userInfo",e.userInfo);var s="支付成功("+i+"积分),\n幸运号为"+o.arrcCode;if(o.winner_code){s+="人数已满，<br/>立即开奖\n ";alert(s)}else{s+="前往【夺宝记录】？";if(confirm(s)){a.go("tab.indianaUserList");return false}else{}}t.showpay=true;t.buy.num=0;t.doRefresh()}else{alert(o.msg)}},function(e){console.log(e)})};e.$on("userInfo",function(o,a){t.jf=e.userInfo.jf});t.doRefresh=function(){var a={method:"activityIndianaContent",attach:s.cid};var r=o.zjPost(a);r.then(function(a){t.imgUrl=o.imgUrl;t.status=a.status;if(a.status){t.indiana=a.value.indiana;t.products=a.value.productInfo;t.img=a.value.img;if(e.userInfo){t.jf=e.userInfo.jf}else{t.jf=0}t.productimg=[];if(t.img){t.productimg=t.img.split(",")}if(t.productimg.length>0){n.update()}}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.doRefresh()}).controller("indianaUserListMyCtrl",function(e,t,o,a){t.change=function(e){t.classfy=e;t.doRefresh()};t.tiaozhuan=function(e){a.go("tab.activityIndianaContent",{cid:e})};t.classfy=0;var s={method:"indianaIsWinning"};var n=o.zjPost(s);n.then(function(e){t.indianaIsWinning=e.value},function(e){console.log(e)});t.imgUrl=o.imgUrl;t.page=0;t.domore=false;t.myLlist=[];t.change=function(e){t.classfy=e;t.doRefresh()};t.loadeData=function(){var e={method:"indianaUserList",attach:t.classfy,page:t.page};var a=o.zjPost(e);a.then(function(e){if(e.status){for(v in e.value){t.myLlist.push(e.value[v])}}else{t.domore=true}if(t.myLlist.length>0){t.status=true}else{t.status=false}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.loadMore=function(){t.page++;t.loadeData()};t.doRefresh=function(){t.status=true;t.domore=false;t.page=0;t.myLlist=[];t.loadeData()};t.doRefresh()}).controller("activityCharitablelistMyCtrl",function(e,t,o,a){t.imgUrl=o.imgUrl;t.page=0;t.domore=false;t.list=[];t.loadeData=function(){var e={method:"activityCharitablelist",page:t.page};var a=o.zjPost(e);a.then(function(e){t.status=e.status;if(e.status){t.banner=e.banner;for(v in e.value){t.list.push(e.value[v])}}else{t.domore=true}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.loadMore=function(){t.page++;t.loadeData()};t.doRefresh=function(){t.domore=false;t.page=0;t.list=[];t.loadeData()};t.doRefresh()}).controller("activityCharitableContentMyCtrl",function(e,t,o,a,s,n,r){t.classfy=true;t.page=0;t.domore=true;t.users=[];t.changeClass=function(e){t.classfy=e;if(e){t.domore=true}else{t.domore=false;t.page=0;t.users=[];t.loadeData()}};t.loadeData=function(){var e={method:"activityCharitableUser",attach:s.cid,page:t.page};var a=o.zjPost(e);a.then(function(e){t.status=e.status;if(e.status){for(v in e.value){t.users.push(e.value[v])}}else{t.domore=true}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.loadMore=function(){t.page++;t.loadeData()};e.$on("userInfo",function(o,a){t.jf=e.userInfo.jf});t.jf=e.userInfo.jf;t.doRefresh=function(){var e={method:"activityCharitableContent",attach:s.cid};var a=o.zjPost(e);a.then(function(e){t.status=e.status;if(e.status){t.imgUrl=o.imgUrl;t.l=e.value}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.doRefresh();t.user={jfjz:null};t.isOpen=false;t.juanzeng=function(e){var o=t.jf;var a=e.jfjz;if(!e.jfjz){alert("积分请填写积分");t.isOpen=true;return false}var s=t.l.limit_type;var n=t.l.data_limit;var r=t.l.today_data_limit;if(n>0&&r<a){if(confirm("今日最多可捐赠限额为"+r+"积分,是否捐赠")){t.user.jfjz=r}else{return false}}if(a>o||o<=0){alert("积分不足");return false}if(s=="3"){var l=t.l.all_limit-t.l.already_charitable;if(a>l){if(confirm("该活动现在最多可捐赠"+l+"积分,是否捐赠")){t.user.jfjz=l}else{return false}}}t.pay(t.user.jfjz)};t.scrollTonlist=function(){r(function(){n.$getByHandle("start").scrollBottom()},10)};t.pay=function(a){var n=e.username;var r={cid:s.cid,jf:a};var l={method:"payCharitable",value:r};var i=o.zjPost(l);i.then(function(o){if(o.status){alert("成功捐赠"+a+"积分");t.user.jfjz=null;t.doRefresh();t.changeClass(false);t.scrollTonlist();e.userInfo.jf=o.jf;e.$broadcast("userInfo",e.userInfo)}else{alert(o.msg)}},function(e){console.log(e)})}}).controller("charitableUserListMyCtrl",function(e,t,o,a){t.doRefresh=function(){var e={method:"getcharitableUsersumPrice"};var a=o.zjPost(e);a.then(function(e){t.charitableUsersumPrice=e.value},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")});var e={method:"charitableUserList",page:t.page};var a=o.zjPost(e);a.then(function(e){t.imgUrl=o.imgUrl;t.status=e.status;if(e.status){t.users=e.value}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh();t.getItemHeight=function(e,t){return t%2===0?50:100}}).controller("couponListMyCtrl",function(e,t,o,a,s){t.classfy=0;var n={method:"coupon_invalid"};var r=o.zjPost(n);r.then(function(e){t.coupon_invalid=e.value},function(e){console.log(e)});t.page=0;t.domore=false;t.coupons=[];t.change=function(e){t.classfy=e;t.doRefresh()};t.loadeData=function(){var e={method:"couponList",attach:t.classfy,page:t.page};var a=o.zjPost(e);a.then(function(e){if(e.status){t.imgUrl=o.imgUrl;for(v in e.value){t.coupons.push(e.value[v])}}else{t.domore=true}if(t.coupons.length>0){t.status=true}else{t.status=false}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.loadMore=function(){t.page++;t.loadeData()};t.doRefresh=function(){t.status=true;t.domore=false;t.page=0;t.coupons=[];t.loadeData()};t.doRefresh()}).controller("headMyCtrl",function(e){}).controller("footMyCtrl",function(e,t,o){t.tiaozhuan=function(e){o.go(e)}}).controller("newsMyCtrl",function(e,t,o,a){var s={method:"newsClassfy"};var n=o.zjPost(s);n.then(function(e){t.newsclassfy=e.value;t.classfy=e.value[0].id;t.page=0;t.items=[];t.domore=false;t.doRefresh()},function(e){console.log(e)});t.loadeData=function(){var e={method:"newsContentlist",attach:t.classfy,page:t.page};var a=o.zjPost(e);a.then(function(e){if(e.status){for(v in e.value){t.items.push(e.value[v])}}else{t.domore=true}if(t.items.length>0){t.status=true}else{t.status=false}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.change=function(e){t.classfy=e;t.doRefresh()};t.loadMore=function(){t.page++;t.loadeData()};t.doRefresh=function(){t.status=true;t.domore=false;t.page=0;t.items=[];t.loadeData()}}).controller("newsContentMyCtrl",function(e,t,o,a){t.imgUrl=o.imgUrl;t.doRefresh=function(){var e={method:"newsContent",attach:a.nid};var s=o.zjPost(e);s.then(function(e){t.info=e.value},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh()}).directive("headmenu",function(e){var t="";t+="\t\t<div class='col col-10'>";t+="\t\t\t<a class='sit' href='#'><span>全国 <i class='icon ion-ios-arrow-down'></i></span></a>";t+="\t\t</div>";t+="\t\t<div class='col col-80'>";t+="\t\t\t<label class='item-input-wrapper'>";t+="\t\t\t\t<i class='icon ion-ios-search placeholder-icon'></i>";t+="\t\t\t\t<form ng-submit='searchProduct(search)'><input type='search' ng-model='search' ng-blur='searchProduct(search)' placeholder='搜索商家、商品'></form>";t+="\t\t\t</label>";t+="\t\t</div>";t+="\t\t<div class='col col-10'>";t+="\t\t\t<a class='news' href='#/tab/news' title='新闻'></a>";t+="\t\t</div>";t+="\t";return{restrict:"E",template:t,link:function(t,o,a){t.searchProduct=function(t){e.go("tab.productList",{meth:"search",val:t})}}}}).controller("classlistMyCtrl",function(e,t,o,a){t.doRefresh=function(){var e={method:"getclasslist",attach:t.classfyid};var o=a.zjPost(e);o.then(function(e){t.status=e.status;t.productInfo=e.value},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};var s={method:"getclasslistMain"};var n=a.zjPost(s);n.then(function(e){if(e.status){t.imgUrl=a.imgUrl;t.classfy=e.value;t.classfyid=e.value[0].classid;t.doRefresh()}},function(e){console.log(e)});t.show=function(e){t.classfyid=e;t.doRefresh()}}).directive("errSrc",function(){return{link:function(e,t,o){t.bind("error",function(){if(o.src!=o.errSrc){o.$set("src",o.errSrc)}})}}}).controller("productlistMyCtrl",function(e,t,o,a,s){var n=a.val;var r=a.meth;t.imgUrl=s.imgUrl;t.page=0;t.domore=false;t.products=[];t.loadeData=function(){var e={method:"getproductlist",page:t.page,attach:n,meth:r};var o=s.zjPost(e);o.then(function(e){t.status=e.status;if(e.status){for(v in e.value){t.products.push(e.value[v])}}else{t.domore=true}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.loadMore=function(){t.page++;t.loadeData()};t.doRefresh=function(){t.domore=false;t.page=0;t.products=[];t.loadeData()};t.doRefresh()}).controller("getGoodsMyCtrl",function(e,t,o,a,s){o.getUserSit();e.$on("selectsit",function(o,a){if(e.selectsit){t.addessesstatus=true;t.addesses=e.selectsit;t.sit=t.addesses.id}else{t.addessesstatus=false}});var n=s.meth;var r=s.pid;var l=s.cid;t.doRefresh=function(){var e={method:"pcontent",attach:r};var a=o.zjPost(e);a.then(function(e){if(e.status){t.products=e.value;t.productssn=e.value.sn;t.imgUrl=o.imgUrl;for(var a in t.productssn){t.data={clientSide:a}}}else{alert(e.msg);history.go("-1")}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh();t.selectsit=function(){var t={cid:l,pid:r,meth:n};var o={name:"getGoods",value:t};e["isNeedSelectSit"]=o;e.$broadcast("isNeedSelectSit",e["isNeedSelectSit"]);a.go("tab.receivelist")};t.tijiao=function(){if(!t.addessesstatus){alert("请选择收货地址...")}var s=t.sit;var r=e.username;var i=sessionStorage.getItem("xd");i=JSON.parse(i);if(n=="1"){var c="makeOrderFromeCoupon"}else{var c="makeOrderFromeIndiana"}var u={method:c,value:t.data.clientSide,val:l,sitid:s};var f=o.zjPost(u);f.then(function(e){if(e.status){a.go("tab.orderlist",{sid:"2"})}else{alert("无效领取")}},function(e){console.log(e)})}}).controller("pcontentMyCtrl",function(e,t,o,a,s,n){var r=s.pid;t.imgUrl=o.imgUrl;e.$on("ss",function(o,a){t.mycarts=e.ss;t.doRefresh()});t.doRefresh=function(){t.mycarts=e.ss;var a={method:"pcontent",attach:s.pid};var r=o.zjPost(a);r.then(function(e){t.status=e.status;if(e.status){t.products=e.value;if(t.products.img.length>0){n.update()}if(t.mycarts&&t.mycarts.value){if(t.mycarts.value[e.value.shop]){if(t.mycarts.value[e.value.shop][s.pid]){for(snid in e.value.sn){if(t.mycarts.value[e.value.shop][s.pid].sn[snid]){}else{t.mycarts.value[e.value.shop][s.pid].sn[snid]=e.local.value[e.value.shop][s.pid].sn[snid]}}}else{t.mycarts.value[e.value.shop][s.pid]=e.local.value[e.value.shop][s.pid]}}else{t.mycarts.value[e.value.shop]=e.local.value[e.value.shop]}}else{t.mycarts=e.local}}},function(e){}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh();t.fjisuan=function(e,o){var a=parseInt(e.localNum);var n=parseInt(e.num);if(o>0){if(a>n-o){o=0}}else{if(a<=0){o=0}}if(t.mycarts.value[t.products.shop][s.pid].sn[e.id].localNum<=0){t.mycarts.value[t.products.shop][s.pid].sn[e.id].localNum=0}t.mycarts.value[t.products.shop][s.pid].sn[e.id].localNum+=o;if(t.mycarts.value[t.products.shop][s.pid].localNum<=0){t.mycarts.value[t.products.shop][s.pid].localNum=0}t.mycarts.value[t.products.shop][s.pid].localNum+=o};t.tiaozhuan=function(e){o.jisuantotal(t.mycarts.value,"ss");var n=false;if(t.mycarts.value[t.products.shop][s.pid]){if(t.mycarts.value[t.products.shop][s.pid].localNum>0){n=true}}if(!n){alert("您还没有选哦~");return false}if(e=="buy"){var r={};r[t.products.shop]={};r[t.products.shop][s.pid]=t.mycarts.value[t.products.shop][s.pid];o.jisuantotal(r,"xd");var l="addorder"}else{var l="mycart"}a.go("tab."+l)}}).controller("mycartlistMyCtrl",function(e,t,o,a,s){e.$on("ss",function(o,a){t.mycarts=e.ss});t.doRefresh=function(){t.data={showDelete:false,showReorder:false};t.mycarts=e.ss;t.imgUrl=a.imgUrl};t.$on("$ionicView.beforeEnter",function(){t.doRefresh()});t.toPage=function(e,t){o.go(e,t)};t.fjisuan=function(e,o,s,n){var r=parseInt(s.localNum);var l=parseInt(s.num);if(n>0){if(r>l-n){n=0}}else{if(r<=0){n=0}}t.mycarts.value[e][o].sn[s.id].localNum+=n;t.mycarts.value[e][o].localNum+=n;a.jisuantotal(t.mycarts.value,"ss")};t.doCheckRefresh=function(e){a.jisuantotal(t.mycarts.value,"ss")};t.doAllChecked=function(e){a.jisuantotal(t.mycarts.value,"ss","doCheck",t.mycarts.allChecked)};t.showHide=function(){t.data.showDelete=!t.data.showDelete;t.data.showReorder=!t.data.showReorder};t.deleteseesion=function(){if(t.mycarts.checkTotalPrice>0){a.jisuantotal(t.mycarts.value,"ss","deletCheck")}else{alert("您还没有选哦~");return false}};t.deletePid=function(e){a.jisuantotal(t.mycarts.value,"ss","deletePid",e)};t.tijiao=function(){if(t.mycarts.checkTotalPrice>0){a.jisuantotal(t.mycarts.value,"xd","creatCheck","ss");o.go("tab.addorder")}else{alert("您还没有选哦~");return false}}}).controller("addorderMyCtrl",function(e,t,o,s){t.imgUrl=o.imgUrl;o.getUserSit();e.$on("selectsit",function(o,a){if(e.selectsit){t.addessesstatus=true;t.addesses=e.selectsit;t.sit=t.addesses.id}else{t.addessesstatus=false}});t.selectsit=function(){var t={name:"addorder",value:{}};e["isNeedSelectSit"]=t;e.$broadcast("isNeedSelectSit",e["isNeedSelectSit"]);s.go("tab.receivelist")};t.checkXd=function(){var e=true;if(t.mycarts){if(t.mycarts.totalPrice>0){e=false}}if(e){s.go("tab.mycart")}};t.mycarts=e.xd;t.checkXd();e.$on("xd",function(o,a){t.mycarts=e.xd;t.checkXd()});t.fjisuan=function(e,a,s,n){var r=parseInt(s.localNum);var l=parseInt(s.num);if(n>0){if(r>l-n){n=0}}else{if(r<=0){n=0}}t.mycarts.value[e][a].sn[s.id].localNum+=n;t.mycarts.value[e][a].localNum+=n;o.jisuantotal(t.mycarts.value,"xd")};t.tijiao=function(){if(!t.addessesstatus){alert("请选择收货地址...")}var n={method:"makeOrder",attach:t.mycarts,sitid:t.sit};var r=o.zjPost(n);r.then(function(t){var o=e.xd.value;var n=e.ss.value;if(t.status){var r={checkTotalPrice:0,checkTotalNum:0,totalPrice:0,totalNum:0,allChecked:true,value:e.ss.value};if(n){for(a in n){for(b in n[a]){for(c in n[a][b].sn){if(n[a][b]&&o[a][b]){if(o[a][b].sn[c].localNum>0){r.value[a][b].localNum-=r.value[a][b].sn[c].localNum;r.value[a][b].sn[c].localNum=0}}if(r.value[a][b].localNum>0){r.totalNum+=r.value[a][b].sn[c].localNum;r.totalPrice+=r.value[a][b].integral*r.value[a][b].sn[c].localNum;if(!r.value[a][b].sn[c].checked){r.checkTotalNum+=r.value[a][b].sn[c].localNum;r.checkTotalPrice+=r.value[a][b].integral*r.value[a][b].sn[c].localNum}else{r.allChecked=false}}}}}}var l=JSON.stringify(r);sessionStorage.setItem("ss",l);sessionStorage.setItem("xd",null);e["xd"]=null;e.$broadcast("xd",e["xd"]);e["ss"]=r;e.$broadcast("ss",e["ss"]);s.go("tab.pay",{type:"ordermain",oid:t.order})}},function(e){console.log(e)})}}).controller("receivelistMyCtrl",function(e,t,o,a,s,n){t.showHide=function(){t.data.showDelete=!t.data.showDelete;t.data.showReorder=!t.data.showReorder};t.doRefresh=function(){t.data={showDelete:false,showReorder:false};var e={method:"receivelist"};var a=o.zjPost(e);a.then(function(e){t.addesses=e.value;t.status=e.status},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.$on("$ionicView.beforeEnter",function(){t.doRefresh()});e.$on("isNeedSelectSit",function(o,a){t.isNeedSelectSit=e.isNeedSelectSit});t.selectsit=function(s){if(t.isNeedSelectSit){var n=e.isNeedSelectSit.name;var r=e.isNeedSelectSit.value;o.getUserSit(s);e["isNeedSelectSit"]=null;e.$broadcast("isNeedSelectSit",e["isNeedSelectSit"]);a.go("tab."+n,r)}else{}return false};t.tiaozhuan=function(){a.go("tab.addreceiver")};t.deleSit=function(a){var s=e.username;var n={sitid:a.id};var r={method:"delesit",value:n};var l=o.zjPost(r);l.then(function(e){t.doRefresh()},function(e){console.log(e)});return false};t.editSit=function(e){a.go("tab.editreceiver",{rid:e.id});return false}}).controller("addreceivelistMyCtrl",function(e,t,o,a){var s={method:"province"};var n=o.zjPost(s);n.then(function(e){t.provinces=e.value;t.status=e.status},function(e){console.log(e)});t.pushNotificationChange=function(){};t.user={name:"",tel:"",pro:"",cit:"",are:"",address:"",checked:false};t.getsit=function(e,a){var s={method:e,attach:a};var n=o.zjPost(s);n.then(function(o){if(e=="city"){t.citys=o.value}else{t.areas=o.value}},function(e){console.log(e)})};t.check=function(e){var t=e.name;var s=e.tel;var n=e.pro;var r=e.cit;var l=e.are;var i=e.address;var c=e.checked?1:0;var u={name:t,tel:s,province:n,city:r,marea:l,address:i,type:c};var f={method:"addreceiver",value:u};var d=o.zjPost(f);d.then(function(e){if(e.status){a.go("tab.receivelist")}},function(e){console.log(e)})}}).controller("editreceiverMyCtrl",function(e,t,o,a,s){var n=a.rid;t.doRefresh=function(){var e={method:"province"};var a=o.zjPost(e);a.then(function(e){t.provinces=e.value},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")});var e={method:"getonesit",attach:n};var a=o.zjPost(e);a.then(function(e){t.oneSitInfo=e.value;var o=t.oneSitInfo.type>0?true:false;t.user={name:e.value.name,tel:parseInt(e.value.tel),pro:e.value.province,cit:e.value.city,are:e.value.area,address:e.value.address,checked:o};t.getsit("city",e.value.province);t.getsit("area",e.value.city)},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.$on("$ionicView.beforeEnter",function(){t.doRefresh()});t.getsit=function(e,a){var s={method:e,attach:a};var n=o.zjPost(s);n.then(function(o){if(e=="city"){t.citys=o.value}else{t.areas=o.value}},function(e){console.log(e)})};t.check=function(t){var a=t.name;var r=t.tel;var l=t.pro;var i=t.cit;var c=t.are;var u=t.address;var f=t.checked?1:0;var d=e.username;var v={rid:n,name:a,tel:r,province:l,city:i,marea:c,address:u,type:f};var m={method:"editreceiver",value:v};var h=o.zjPost(m);h.then(function(e){if(e.status){s.go("tab.receivelist")}},function(e){console.log(e)})}}).controller("orderContentMyCtrl",function(e,t,o,a,s,n){t.doRefresh=function(){var e={method:"orderContent",orderId:a.oid};var s=o.zjPost(e);s.then(function(e){t.ostatus=e.status;if(e.status){t.orderlist=e.value;t.imgUrl=o.imgUrl}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.receiveOrder=function(e){o.receiveOrder(e,function(e){if(e.status){t.doRefresh()}})};t.deleteOrder=function(e){o.deleteOrder(e,function(e){if(e.status){t.doRefresh()}})};t.doRefresh()}).controller("orderlistMyCtrl",function(e,t,o,a,s){a.sid?t.orderstatus=a.sid:t.orderstatus=2;t.imgUrl=o.imgUrl;t.page=0;t.domore=false;t.orderlistInfo=[];t.loadeData=function(){var e={method:"orderlist",page:t.page,status:t.orderstatus};var a=o.zjPost(e);a.then(function(e){t.ostatus=e.status;if(e.status){for(v in e.value){t.orderlistInfo.push(e.value[v])}}else{t.domore=true}if(t.orderlistInfo.length>0){t.status=true}else{t.status=false}},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.infiniteScrollComplete");t.$broadcast("scroll.refreshComplete")})};t.getOrderList=function(e){t.orderstatus=e;t.doRefresh()};t.loadMore=function(){t.page++;t.loadeData()};t.doRefresh=function(){t.status=true;t.domore=false;t.page=0;t.orderlistInfo=[];t.loadeData()};t.doRefresh();t.tiaozhuan=function(e,t){s.go(e,t)};t.deleteOrder=function(e){o.deleteOrder(e,function(e){if(e.status){t.doRefresh()}})};t.receiveOrder=function(e){o.receiveOrder(e,function(e){if(e.status){t.doRefresh()}})}}).controller("payMyCtrl",function(e,t,o,a,s){e.$on("userInfo",function(o,a){t.jf=e.userInfo.jf});t.doRefresh=function(){if(e.userInfo){t.jf=e.userInfo.jf}else{t.jf=0}var o={method:"orderlist",meth:a.type,attach:a.oid};var n=s.zjPost(o);n.then(function(e){t.imgUrl=s.imgUrl;t.orderlist=e.value;t.status=e.status;t.alltotal=e.alltotal;t.orderstatus=e.orderstatus},function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete")})};t.doRefresh();t.pay=function(){var t={orderId:a.oid,type:a.type};var n={method:"pay",value:t};var r=s.zjPost(n);r.then(function(t){if(t.status){alert("支付成功！");if(t.locationUrl){var a=t.locationUrl.vkey;var s=t.locationUrl.id;if(a=="2"){o.go("tab.orderContent",{oid:s})}else{o.go("tab.couponCode",{cid:s})}e.userInfo.jf=t.jf;e.$broadcast("userInfo",e.userInfo)}}else{alert(t.msg)}},function(e){console.log(e)})}}).directive("myfocus",function(e,t){return{link:function(o,a,s){var n=t(s.myfocus);o.$watch(n,function(t){if(t===true){e(function(){a[0].focus()})}else if(t===false){e(function(){a[0].blur()})}})}}});