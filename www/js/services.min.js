angular.module("starter.services",[]).service("myService",["$http","$q","$rootScope","$state",function(e,t,o,r){this.appHost="http://zelar.yhbz.net/xd/";this.ajaxUrlfile=this.appHost+"data2/";var s=this.ajaxUrlfile+"postInfoAll.php";this.imgUrl=this.appHost+"upload/";this.isRemember=false;var n=this;this.getJf=function(){var e={method:"get_jf"};if(arguments[0]){e.username=arguments[0]}var a=n.zjPost(e);a.then(function(e){o.userInfo.jf=e.jf;o.$broadcast("userInfo",o.userInfo)},function(e){o.userInfo.jf=0;o.$broadcast("userInfo",o.userInfo)})};this.getUserSit=function(){if(!o.selectsit||arguments[0]){var e={method:"receivelist",attach:"moren"};if(arguments[0]){e={method:"receivelist",attach:arguments[0]}}var a=n.zjPost(e);a.then(function(e){if(e.status){o.selectsit=e.value[0];o.$broadcast("selectsit",e.value[0])}},function(e){console.log(e)})}};this.setUsername=function(){var e=false;if(typeof localStorage==="object"){try{localStorage.setItem("localStorage",1);localStorage.removeItem("localStorage")}catch(e){Storage.prototype._setItem=Storage.prototype.setItem;Storage.prototype.setItem=function(){};alert("请勿禁止缓存～")}}if(arguments[0]){var a=arguments[0];if(a.status){e=true;o.userInfo=a;o.islogin=1;var t=n.isRemember;if(arguments[1]){t=arguments[1]}var s=JSON.stringify(a);localStorage.setItem("userInfo",s);if(t){localStorage.setItem("islogin",1)}else{sessionStorage.setItem("islogin",1)}o.$broadcast("islogin",o.islogin);o.$broadcast("userInfo",o.userInfo);r.go("tab.home")}}return e};this.zjGet=function(a){var o=s+"?m=get";if(arguments[1]){o=n.ajaxUrlfile+arguments[1]}var r=t.defer();e({method:"POST",url:o,data:a}).success(function(e,a,t,o){r.resolve(e)}).error(function(e,a,t,o){r.reject(e)});return r.promise};this.zjPost=function(a){if(!a.username){if(o.userInfo){a.username=o.userInfo.username;a.shopToken=o.userInfo.shopToken;a.service=o.userInfo.service}}var r=s+"?m=post";if(arguments[1]){r=n.ajaxUrlfile+arguments[1]}var i=t.defer();e({method:"POST",url:r,data:a}).success(function(e,a,t,o){if(!e.safeStatus){n.fLogOut()}i.resolve(e)}).error(function(e,a,t,o){i.reject(e)});return i.promise};this.winready=function(e){if(window.plus){e()}else{document.addEventListener("plusready",e,false)}};this.toast=function(e){n.winready(function(){plus.nativeUI.toast(e,{duration:"long"})})};this.fLogOut=function(){sessionStorage.removeItem("islogin");localStorage.removeItem("islogin");o.userInfo=null;o.quickLogon=false;if(arguments[0]&&arguments[1]){var e=arguments[0];var a=arguments[1];r.go("tab.login",{sid:e,username:a})}else{r.go("tab.login",{sid:null,username:null})}};this.fLogin=function(e,a,t,o){var r="0";var s="0";var i="0";var l="0";n.winready(function(){var e=plus.push.getClientInfo();r=e.token;s=e.clientid;i=e.appid;l=e.appkey});var c={username:e,pwd:a,service:t,token:r,clientid:s,appid:i,appkey:l};return c};this.jisuantotal=function(){if(arguments[0]&&arguments[1]){var e=arguments[0];var t=arguments[1];var r={checkTotalPrice:0,checkTotalNum:0,totalPrice:0,totalNum:0,allChecked:true,value:e};if(r.value){for(a in r.value){for(b in r.value[a]){for(c in r.value[a][b].sn){if(r.value[a][b]){if(arguments[2]=="doCheck"){var s=arguments[3];if(s){r.value[a][b].sn[c].checked=true}else{r.value[a][b].sn[c].checked=false}}else if(arguments[2]=="deletCheck"){if(r.value[a][b].sn[c].checked){r.value[a][b].localNum-=r.value[a][b].sn[c].localNum;r.value[a][b].sn[c].localNum=0}}else if(arguments[2]=="creatCheck"){if(!r.value[a][b].sn[c].checked){r.value[a][b].localNum-=r.value[a][b].sn[c].localNum;r.value[a][b].sn[c].localNum=0}}else if(arguments[2]=="deletePid"){var n=arguments[3];if(n==c){r.value[a][b].localNum-=r.value[a][b].sn[c].localNum;r.value[a][b].sn[c].localNum=0}}if(r.value[a][b].localNum<=0){}else{r.totalNum+=r.value[a][b].sn[c].localNum;r.totalPrice+=r.value[a][b].integral*r.value[a][b].sn[c].localNum;if(r.value[a][b].sn[c].checked){r.checkTotalNum+=r.value[a][b].sn[c].localNum;r.checkTotalPrice+=r.value[a][b].integral*r.value[a][b].sn[c].localNum}else{r.allChecked=false}}}}}}}var i=JSON.stringify(r);sessionStorage.setItem(t,i);o[t]=r;o.$broadcast(t,r);if(arguments[2]=="creatCheck"){var l=arguments[3];var u=sessionStorage.getItem(l);u=JSON.parse(u);o[l]=u;o.$broadcast(l,u)}}};this.receiveOrder=function(e,a){var t=this.username;var o={orderid:e};var r={method:"receiveOrder",value:o,username:t};var s=n.zjPost(r);s.then(function(e){a(e)},function(e){console.log(e)})};this.deleteOrder=function(e,a){var t={orderid:e};var o={method:"deleteOrder",value:t,username:this.username};var r=n.zjPost(o);r.then(function(e){a(e)},function(e){console.log(e)})}}]).factory("Chats",function(){var e=[{id:0,name:"Ben Sparrow",lastText:"You on your way?",face:"img/ben.png"},{id:1,name:"Max Lynx",lastText:"Hey, it's me",face:"img/max.png"},{id:2,name:"Adam Bradleyson",lastText:"I should buy a boat",face:"img/adam.jpg"},{id:3,name:"Perry Governor",lastText:"Look at my mukluks!",face:"img/perry.png"},{id:4,name:"Mike Harrington",lastText:"This is wicked good ice cream.",face:"img/mike.png"}];return{all:function(){return e},remove:function(a){e.splice(e.indexOf(a),1)},get:function(a){for(var t=0;t<e.length;t++){if(e[t].id===parseInt(a)){return e[t]}}return null}}});